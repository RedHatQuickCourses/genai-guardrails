<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab: Adding a Simple Guardrail to an AI Application :: Guardrails for AI Applications</title>
    <link rel="prev" href="intro.html">
    <link rel="next" href="stacked.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Guardrails for AI Applications</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/genai-guardrails/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="genai-guardrails" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Guardrails for AI Applications</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../intro/index.html">Introduction</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/guardrails.html">Why Guardrails?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/unguarded.html">Lab: LLMs with no Guardrails</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../intro/implementation.html">Implementing Guardrails</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ibm-guardian/index.html">IBM Granite Guardian</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ibm-guardian/intro.html">IBM Granite Guardian</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ibm-guardian/simple.html">Lab: Input Guardrails</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ibm-guardian/response.html">Lab: Output Guardrails</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ibm-guardian/hap.html">IBM HAP Models</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ibm-guardian/hap-lab.html">Lab: IBM HAP Models</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ibm-guardian/custom.html">Lab: Custom Criteria Guardrails</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Guardrails AI</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="intro.html">Introduction to Guardrails AI</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="simple.html">Lab: Simple Guardrails</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="stacked.html">Lab: Stacking Multiple Validators</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="fix.html">Lab: Redacting and Filtering Content</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="server.html">Lab: Guardrails AI Server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../trusty-ai/index.html">Trusty AI (WIP)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../feedback/index.html">Feedback</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Guardrails for AI Applications</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Guardrails for AI Applications</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Guardrails for AI Applications</a></li>
    <li><a href="index.html">Guardrails AI</a></li>
    <li><a href="simple.html">Lab: Simple Guardrails</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab: Adding a Simple Guardrail to an AI Application</h1>
<div id="preamble">
<div class="sectionbody">
<style>
.red { color: red; }
.blue { color: blue; }
.green { color: green; }
.highlight { background-color: yellow; }
</style>
<div class="paragraph">
<p>In this lab, you will use add a simple guardrail to an AI application that accepts input from the user, and checks if it contains any Personal Identifiable Information (PII) in the input.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We do not run any inference LLM model in this lab, and we restrict ourselves to the core Guardrails functionality of checking inputs.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pre_requistes"><a class="anchor" href="#_pre_requistes"></a>Pre-requistes</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Python v3.12 (The labs in this course were tested with Python 3.12 on macOS. Note that Python &gt;3.12 is not supported for now)</p>
</li>
<li>
<p>The <code>pip</code> CLI to install Python libraries</p>
</li>
<li>
<p>Git CLI to clone the sample code from GitHub</p>
</li>
<li>
<p>Visual Studio Code or other editors to edit Python code</p>
</li>
<li>
<p>You need to create an account for Guardrails AI Hub (<a href="https://hub.guardrailsai.com" class="bare">https://hub.guardrailsai.com</a>). Do the following</p>
<div class="ulist">
<ul>
<li>
<p>Using a web browser, navigate to <a href="https://hub.guardrailsai.com/keys" class="bare">https://hub.guardrailsai.com/keys</a></p>
</li>
<li>
<p>Click on the <code>Sign in to get started</code> button</p>
</li>
<li>
<p>Create a new account, or sign in using your GitHub or Google credentials</p>
<div class="imageblock">
<div class="content">
<img src="_images/gh2.png" alt="gh2" width="400" height="400">
</div>
<div class="title">Figure 1. Sign in to Guardrails AI Hub</div>
</div>
</li>
<li>
<p>After you log in, click on <code>Create API key</code> button</p>
<div class="imageblock">
<div class="content">
<img src="_images/gh3.png" alt="gh3" width="400" height="400">
</div>
<div class="title">Figure 2. API keys page</div>
</div>
</li>
<li>
<p>In the pop-up dialog for creating keys, give a unique name for your key and select the duration you want the keys to be active.</p>
<div class="imageblock">
<div class="content">
<img src="_images/gh4.png" alt="gh4" width="400" height="400">
</div>
<div class="title">Figure 3. Create API key</div>
</div>
</li>
<li>
<p>Copy the API key text to your clipboard and keep it safe. You will use this API key in all the hands-on lab exercises</p>
<div class="imageblock">
<div class="content">
<img src="_images/gh5.png" alt="gh5" width="400" height="400">
</div>
<div class="title">Figure 4. Newly created API key</div>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_steps"><a class="anchor" href="#_steps"></a>Steps</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you have not already done it, clone the Git repository containing the code to a folder of your choice.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>git clone https://github.com/RedHatQuickCourses/genai-apps.git</strong></code></pre>
</div>
</div>
</li>
<li>
<p>All the code for Guardrails AI is in a folder called <code>guardrails/guardrails-ai</code>. Change to this folder in the terminal.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>cd genai-apps/guardrails/guardrails-ai</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Create a virtual environment and activate it.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>python -m venv venv</strong>
$ <strong>source venv/bin/activate</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your prompt should change to indicate that you are now running in an isolated virtual environment.</p>
</div>
</li>
<li>
<p>Install the Guardrails AI library using <code>pip</code>. This will install both the library files and the <code>guardrails</code> CLI tool, which you will use to configure access using the API key you created earlier, as well as download validators from the Guardrails AI Hub.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ (venv) <strong>pip install guardrails-ai</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Run the <code>guardrails configure</code> command to set up access to Guardrails AI Hub</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ (venv) <strong>guardrails configure</strong></code></pre>
</div>
</div>
<div class="paragraph">
<p>You will be asked two questions. Answer <strong>No</strong> to both questions. Finally, paste your API key.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/gh6.png" alt="gh6" width="400" height="400">
</div>
<div class="title">Figure 5. guardrails CLI configuration</div>
</div>
<div class="paragraph">
<p>The guardrails CLI will create a <code>~/.guardrailsrc</code> file in your home directory and store the API ID, API token, and other configuration details.</p>
</div>
</li>
<li>
<p>Install the <code>termcolor</code> library using <code>pip</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ (venv) <strong>pip install termcolor</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Inspect the <code>gai-basic.py</code> file in a text editor of your choice. We start off by importing the <code>install</code> class from the <code>guardrails-ai</code> library. It is used to install validators from the Guardrails AI Hub. In this case, we import the <code>DetectPII</code> validator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">...
# Import the install class from guardrails-ai library
from guardrails import install

# Install the DetectPII validator
install(
    "hub://guardrails/detect_pii", <i class="conum" data-value="1"></i><b>(1)</b>
    install_local_models=True, <i class="conum" data-value="2"></i><b>(2)</b>
    quiet=False <i class="conum" data-value="3"></i><b>(3)</b>
)
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The validator ID for the DetectPII validator on Guardrails AI Hub</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Some validators use small, customized models for validation. These can be stored locally.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Silence warnings during install</td>
</tr>
</table>
</div>
</li>
<li>
<p>Create a <code>Guard</code> object and use the <code>DetectPII</code> validator.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">...
# Import Guard and Validator
from guardrails.hub import DetectPII <i class="conum" data-value="1"></i><b>(1)</b>
from guardrails import Guard
from termcolor import colored, cprint

# Setup Guard
guard = Guard().use( <i class="conum" data-value="2"></i><b>(2)</b>
    DetectPII, ["EMAIL_ADDRESS", "PHONE_NUMBER", "US_SSN"], "exception" <i class="conum" data-value="3"></i><b>(3)</b>
)
...</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Import the Validator</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Create a <code>Guard</code> object using the validator</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>DetectPII</code> validator takes two arguments - a list of <code>entities</code> (email IDs, phone numbers, SSN, Passport numbers, and more) that should be checked in the input as an argument, along with the action it needs to take if it detects these entities in the input. In this case we simply throw an exception.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Consult the <code>DetectPII</code> validator documentation at <a href="https://hub.guardrailsai.com/validator/guardrails/detect_pii" class="bare">https://hub.guardrailsai.com/validator/guardrails/detect_pii</a>. The list of supported entities is available at <a href="https://microsoft.github.io/presidio/supported_entities/" class="bare">https://microsoft.github.io/presidio/supported_entities/</a>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <code>main()</code> method has a number of method calls with all except the first call commented out.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">...
if __name__ == "__main__":
    valid_response()
    #invalid_response1()
    #invalid_response2()
    #invalid_response3()</code></pre>
</div>
</div>
</li>
<li>
<p>Run the script to test with valid input. The text we are validating is in the <code>valid_response()</code> method.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ (venv) <strong>python gai-basic.py</strong>
Installing hub://guardrails/detect_pii...
[=== ] Running post-install setup
...
Successfully installed guardrails/detect_pii version 0.0.5!

Import validator:
from guardrails.hub import DetectPII

Get more info:
https://hub.guardrailsai.com/validator/guardrails/detect_pii


<span class="green">valid_response(): Response from LLM is valid...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since there are no visible PII in the input text, the validator allows this text to be processed further in our AI application.</p>
</div>
</li>
<li>
<p>Next, inspect the <code>invalid_response1()</code>, <code>invalid_response2()</code>, and <code>invalid_response3()</code> methods. We are checking for Email IDs, SSNs, and phone numbers in these methods respectively.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">...
def invalid_response1():
    try:
        guard.validate(
        "Hi John Doe! Can you please verify your email ID john.doe@example.com"
    )
    except Exception as e:
        msg = str(e)
        print(colored('\ninvalid_response1(): Response from LLM is invalid\n', 'red'))
        print(colored(f"{msg}", 'red', attrs=['bold']))


def invalid_response2():
    try:
        guard.validate(
        "Hi John Doe! Can you please verify your if your social security number is 615-49-2540"
    )
    except Exception as e:
        msg = str(e)
        print(colored('\ninvalid_response2(): Response from LLM is invalid\n', 'red'))
        cprint(f"{msg}", 'red', attrs=['bold'])

def invalid_response3():
    try:
        guard.validate(
        "You can contact John Doe at +1 408-447-4433"
    )
    except Exception as e:
        msg = str(e)
        print(colored('\ninvalid_response3(): Response from LLM is invalid\n', 'red'))
        cprint(f"{msg}", 'red', attrs=['bold'])
...</code></pre>
</div>
</div>
</li>
<li>
<p>Finally, uncomment all the method calls in the <code>main()</code> method</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-python hljs" data-lang="python">...
if __name__ == "__main__":
    valid_response()
    invalid_response1()
    invalid_response2()
    invalid_response3()
...</code></pre>
</div>
</div>
</li>
<li>
<p>Run the script once again.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ (venv) <strong>python gai-basic.py</strong>
...
<span class="green">valid_response(): Response from LLM is valid...</span>

<span class="red">invalid_response1(): Response from LLM is invalid

Validation failed for field with errors: The following text in your response contains PII:
Hi John Doe! Can you please verify your email ID john.doe@example.com

invalid_response2(): Response from LLM is invalid

Validation failed for field with errors: The following text in your response contains PII:
Hi John Doe! Can you please verify your if your social security number is 615-49-2540

invalid_response3(): Response from LLM is invalid

Validation failed for field with errors: The following text in your response contains PII:
You can contact John Doe at +1 408-447-4433</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The validator has correctly identified that the text in these method calls have PII in them, and thows an exception. We catch these exceptions and display the validator error messages in red font.</p>
</div>
</li>
<li>
<p>Experiment with more input texts and verify that the validator rejects them. A sample test is commented out in the script at the bottom. Refer to the supported entities page at <a href="https://microsoft.github.io/presidio/supported_entities/" class="bare">https://microsoft.github.io/presidio/supported_entities/</a> and try and use a few. Try validating with different input texts and see if you can trigger false positives.</p>
</li>
</ol>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="intro.html">Introduction to Guardrails AI</a></span>
  <span class="next"><a href="stacked.html">Lab: Stacking Multiple Validators</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
